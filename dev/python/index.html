<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Python · CrystalNets.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CrystalNets.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li class="is-active"><a class="tocitem" href>Python</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li></ul></li><li><a class="tocitem" href="../faq/">FAQ</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../lib/public/">Public</a></li><li><a class="tocitem" href="../lib/internals/">Internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Python</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Python</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/coudertlab/CrystalNets.jl/blob/master/docs/src/python.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Python-interface"><a class="docs-heading-anchor" href="#Python-interface">Python interface</a><a id="Python-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Python-interface" title="Permalink"></a></h1><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>It is possible to call Julia code from Python using the dedicated package <a href="https://cjdoris.github.io/PythonCall.jl/stable/juliacall/">juliacall</a>. This page is a simple tutorial detailing how to set it up and use it for CrystalNets.</p><p>In the folder where you intend to put your python script, add a new file called <code>juliapkg.json</code> with the following content:</p><pre><code class="language-json hljs">{
    &quot;julia&quot;: &quot;1&quot;,
    &quot;packages&quot;: {
        &quot;CrystalNets&quot;: {
            &quot;uuid&quot;: &quot;7952bbbe-a946-4118-bea0-081a0932faa9&quot;,
            &quot;version&quot;: &quot;0.4&quot;
        }
    }
}</code></pre><p>then install juliacall with <code>pip install juliacall</code>. From there, you can call CrystalNets by starting your python script with the following three lines:</p><pre><code class="language-julia hljs">import juliacall
jl = juliacall.newmodule(&quot;TheNameOfYourModule&quot;) # put whatever name here
jl.seval(&quot;using CrystalNets&quot;)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The very first time these three lines are run in your system, julia will install CrystalNets and its dependencies. This can take a while, but it will only occur once.</p></div></div><p>Afterwards, you can call any function of CrystalNets.jl (and Julia in general) by prefixing them with <code>jl.</code>, for instance:</p><pre><code class="language-python hljs">&gt;&gt;&gt; jl.determine_topology(&quot;/path/to/MIL-53.cif&quot;)
[ Error: Atom ?, used in a bond, has either zero or multiple placements in the CIF file. This invalidates all bonds from the file, which will thus be discarded.
[ Warning: Guessing bonds with custom algorithm (from Chemfiles and VMD). This may take a while for big structures and may be inexact.
[ Info: To avoid guessing bonds, use a file format that contains the bonds.
Export of input is enabled: saving file at /tmp/input_MIL-53.vtf
Export of subnet_Auto is enabled: saving file at /tmp/subnet_Auto_MIL-53.vtf
Julia: rna</code></pre><p>Compare this to the equivalent REPL execution in Julia:</p><pre><code class="language-python hljs">julia&gt; using CrystalNets

julia&gt; determine_topology(&quot;/path/to/MIL-53.cif&quot;)
[ Error: Atom ?, used in a bond, has either zero or multiple placements in the CIF file. This invalidates all bonds from the file, which will thus be discarded.
[ Warning: Guessing bonds with custom algorithm (from Chemfiles and VMD). This may take a while for big structures and may be inexact.
[ Info: To avoid guessing bonds, use a file format that contains the bonds.
Export of input is enabled: saving file at /tmp/input_MIL-53.vtf
Export of subnet_Auto is enabled: saving file at /tmp/subnet_Auto_MIL-53.vtf
rna</code></pre><p>The same warnings are printed at the beginning, followed by the same exports. The only difference is that the result, <strong>rna</strong> (the topology of MIL-53), is prefixed by <code>Julia:</code> in the Python output.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>You can disable the warnings and/or the exports by adding the following lines after the three initial lines above:</p><pre><code class="language-python hljs">jl.CrystalNets.toggle_warning(False) # to disable warnings
jl.CrystalNets.toggle_export(False) # to disable exports</code></pre></div></div><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>Let&#39;s now consider a programmatic use-case where the goal is to identify the topology of a complex MOF structure according the <a href="../lib/public/#CrystalNets.Clustering"><code>SingleNodes</code></a> and <a href="../lib/public/#CrystalNets.Clustering"><code>AllNodes</code></a> clusterings. The main structure may contain interpenetrating substructures.</p><p>The function is expected to error if the topologies are different between the two clusterings. Otherwise, it returns a list of pairs whose first element is the dimensionality of the subnet and the second element is the name of the corresponding topology. If there is no known name, the topological genome is used instead.</p><p>The Python code is the following:</p><pre><code class="language-python hljs">def identify_topology(cif):
    &quot;&quot;&quot;Return a list of pairs (dimensionality, topology) for each substructure of the file&quot;&quot;&quot;
    options = jl.CrystalNets.Options(structure=jl.StructureType.MOF)
    # Since the structure is specified as a MOF, the default clusterings are AllNodes and SingleNodes
    result = jl.determine_topology(cif, options) # Main call
    # for each x in result:
    # * x[0] is the topology of the substructure.
    # * x[1] is the catenation multiplicity of this subnet.
    return [check_unique_topology(x[0]) for x in result]

def check_unique_topology(result):
    singlenodes = result[jl.Clustering.SingleNodes] # topology for SingleNodes
    allnodes = result[jl.Clustering.AllNodes] # topology for AllNodes
    if singlenodes != allnodes:
        raise Exception(&quot;SingleNodes result &quot;+str(singlenodes)+&quot; != AllNodes result &quot;+str(allnodes))
    return (jl.ndims(singlenodes.genome), str(singlenodes))</code></pre><p>Let&#39;s try this on a few examples:</p><ul><li>HKUST-1 has a 3-dimensional topology <strong>tbo</strong>:<pre><code class="language-python hljs">&gt;&gt;&gt; identify_topology(&quot;/path/to/HKUST-1.cif&quot;)
[(3, &#39;tbo&#39;)]</code></pre></li><li><a href="https://dx.doi.org/10.5517/cc63w16">ODIZIK</a> is composed of two intepenetrating 2-dimensional topologies <strong>sql</strong><pre><code class="language-python hljs">&gt;&gt;&gt; identify_topology(&quot;/path/to/ODIZIK.cif&quot;)
[(2, &#39;sql&#39;), (2, &#39;sql&#39;)]</code></pre></li><li>MIL-53 is has topology <strong>bpq</strong> with <code>SingleNodes</code> clustering and <strong>rna</strong> with <code>AllNodes</code> so the function errors:<pre><code class="language-python hljs">&gt;&gt;&gt; identify_topology(&quot;/path/to/MIL-53.cif&quot;)
Traceback (most recent call last):
File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
File &quot;&lt;stdin&gt;&quot;, line 11, in identify_topology
File &quot;&lt;stdin&gt;&quot;, line 5, in check_unique_topology
Exception: SingleNodes result bpq != AllNodes result rna</code></pre></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../visualization/">« Visualization</a><a class="docs-footer-nextpage" href="../faq/">FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 16 January 2024 14:17">Tuesday 16 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
