<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Visualization · CrystalNets.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CrystalNets.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>Visualization</a><ul class="internal"><li><a class="tocitem" href="#VMD-setup"><span>VMD setup</span></a></li><li><a class="tocitem" href="#An-example"><span>An example</span></a></li><li><a class="tocitem" href="#exports"><span>Export options</span></a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/public/">Public</a></li><li><a class="tocitem" href="../../lib/internals/">Internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Visualization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Visualization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/coudertlab/CrystalNets.jl/blob/master/docs/src/man/visualization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h1><p>When processing individual files through CrystalNets.jl, it is often useful to check whether the detected net actually corresponds to the expected one. To allow this, both the parsed input file as well as the detected subnets are automatically exported by default as VTF files. This file format is recognized by the molecular visualization program <a href="https://www.ks.uiuc.edu/Research/vmd/">VMD</a> and has the property of including explicit bonds, which is necessary in order to represent nets in an unambiguous way.</p><p>This mini-tutorial shows a setup to conveniently use VMD to check the adequate superposition of the crystal and its underlying net. It is not a VMD tutorial itself: to find more resources, check the <a href="https://www.ks.uiuc.edu/Research/vmd/">official website</a>.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>To toggle off the automatic export of VTF files, use <a href="../../lib/public/#CrystalNets.toggle_export"><code>CrystalNets.toggle_export</code></a>. The automatic export setting is bypassed when giving explicity values to <a href="#exports"><code>export_*</code></a> keyword arguments through <a href="../../lib/public/#CrystalNets.Options"><code>CrystalNets.Options</code></a> or directly to the <a href="../../lib/public/#CrystalNets.determine_topology"><code>determine_topology</code></a> function (and other related functions).</p></div></div><h2 id="VMD-setup"><a class="docs-heading-anchor" href="#VMD-setup">VMD setup</a><a id="VMD-setup-1"></a><a class="docs-heading-anchor-permalink" href="#VMD-setup" title="Permalink"></a></h2><p>After <a href="https://www.ks.uiuc.edu/Development/Download/download.cgi?PackageName=VMD">downloading</a> and installing VMD, it can be convenient to customize your setup to taylor your needs. In addition to the official VMD website, an excellent resource for this is <a href="https://sites.google.com/site/akohlmey/random-hacks/vmd-init-script">Axel Kohlmeyer&#39;s personal website</a>.</p><p>The following code, heavily inspired from that website, can be appended to your <code>.vmdrc</code> or <code>vmd.rc</code> file to automatically show VTF files using CPK representations, with big spheres and bonds for nets and small ones for the input crystal:</p><pre><code class="language-perl hljs">package require pbctools

display projection orthographic  # orthographic makes it easier to see the symmetries

proc reset_viz {molid} {
  # operate only on existing molecules
  if {[lsearch [molinfo list] $molid] &gt;= 0} {
    # delete all representations
    set numrep [molinfo $molid get numreps]
    for {set i 0} {$i &lt; $numrep} {incr i} {
      mol delrep $i $molid
    }
    # add new representations
    mol color Element  # color each atom according to its element
    set name [molinfo $molid get name]
    if {[regexp {.*net.*\.vtf} $name] || [regexp {.*clusters.*\.vtf} $name]} {
        mol representation CPK 1.2 0.6  # for nets: big spheres
    } elseif {[regexp {.*\.vtf} $name]} {
        mol representation CPK 0.6 0.2  # for input: small spheres
    }
    mol selection all
    mol addrep $molid
    pbc box  # add the unit cell
  }
}

proc reset_viz_proxy {args} {
  foreach {fname molid rw} $args {}
  eval &quot;after idle {reset_viz $molid}&quot;
}

trace variable vmd_initialize_structure w reset_viz_proxy

#color Element C black  # uncomment to have carbon atoms in black

after idle { reset_viz 0 }</code></pre><h2 id="An-example"><a class="docs-heading-anchor" href="#An-example">An example</a><a id="An-example-1"></a><a class="docs-heading-anchor-permalink" href="#An-example" title="Permalink"></a></h2><p>Let&#39;s consider IM-19 as an example of crystalline framework we are studying. A CIF file for this structure (available from <a href="https://doi.org/10.1039/B822163D">Chaplais <em>et. al.</em></a> on the <a href="https://dx.doi.org/10.5517/ccry482">CSD</a>) can be accessed at:</p><pre><code class="language-julia-repl hljs">julia&gt; path_to_im19 = joinpath(dirname(dirname(pathof(CrystalNets))), &quot;test&quot;, &quot;cif&quot;, &quot;IM-19.cif&quot;);</code></pre><p>Determining its topology yields the following:</p><pre><code class="language-julia-repl hljs">julia&gt; determine_topology(path_to_im19; bonding=Bonding.Guess, structure=StructureType.MOF)
[ Info: Initial pass found O and C with invalid number of bonds.
Export of input is enabled: saving file at /tmp/input_IM-19_0.vtf
Export of subnet_AllNodes is enabled: saving file at /tmp/subnet_AllNodes_IM-19_0.vtf
Export of subnet_SingleNodes is enabled: saving file at /tmp/subnet_SingleNodes_IM-19_0.vtf
AllNodes: rna
SingleNodes: bpq</code></pre><p>Although not necessary, we manually specified <code>bonding=Bonding.Guess</code> to avoid the following warning</p><pre><code class="language-text hljs">[ Warning: Guessing bonds with custom algorithm (from Chemfiles and VMD). This may take a while for big structures and may be inexact.
[ Info: To avoid guessing bonds, use a file format that contains the bonds.</code></pre><p>The first line of the output is an information about atoms with initial number of bonds. Note that there is no subsequent warning of the form</p><pre><code class="language-text hljs">[ Warning: After attempted fix, found remaining C with invalid number of bonds.</code></pre><p>which indicates that the problem has been internally resolved. It might be good to manually check whether the guessed bonds make sense, as an extra precaution.</p><p>To do so, simply open VMD and load the VTF file corresponding to the input. On Ubuntu, the following shell command can be used:</p><pre><code class="language-bash hljs">vmd /tmp/input_IM-19_0.vtf</code></pre><p>The result will look like this: <img src="../assets/input.jpg" alt="IM-19 visualization in VMD"/></p><p>To visualize the &quot;single nodes&quot; clusters on top of the input, navigate to <code>File</code> -&gt; <code>New Molecule...</code> in the VMD window and load the adequate VTF file (in our case, the one located at <code>/tmp/subnet_SingleNodes_IM-19_0.vtf</code>). The result should look like this: <img src="../assets/singlenodes.jpg" alt="IM-19 with single nodes clusters superposed"/></p><p>To look at the underlying topology only (in our case, the <strong>bpq</strong> net), you can toggle off the visualization of the input file by double-clicking on the <code>D</code> letter left to the input file name in the main VMD window. The result should look like this: <img src="../assets/singlenodesonly.jpg" alt="bpq net underlying IM-19"/></p><h2 id="exports"><a class="docs-heading-anchor" href="#exports">Export options</a><a id="exports-1"></a><a class="docs-heading-anchor-permalink" href="#exports" title="Permalink"></a></h2><p>There are several export options bundled with <code>CrystalNets.jl</code>, documented in the <a href="../../lib/public/#CrystalNets.Options"><code>Options</code></a>. Each of them can be given as keyword arguments to all functions accepting an <code>Options</code> argument, like <a href="../../lib/public/#CrystalNets.determine_topology"><code>determine_topology</code></a>.</p><p>The value of the keyword argument can be either:</p><ul><li>a <code>String</code> representing the path of the directory in which to put the exported file. If empty, this disables the export.</li><li>a <code>Bool</code>: if <code>true</code>, equivalent to <code>tempdir()</code>; if <code>false</code>, disables the export.</li></ul><p>The two exports whose default value is defined by <a href="../../lib/public/#CrystalNets.toggle_export"><code>CrystalNets.toggle_export</code></a> are:</p><ul><li><code>export_input</code> for the parsed structure.</li><li><code>export_subnets</code> for each subnet, defined after clustering and separated into connected components.</li></ul><p>Other available export options are disabled by default:</p><ul><li><p><code>export_trimmed</code> for the trimmed parsed structure. &quot;Trimming&quot; refers to removing all atoms that have strictly less than three neighbours and bonding those neighbours together, and so iteratively until no atom remains with strictly less than three neighbours.</p><p>This export can be useful for debugging since the clustering algorithm runs on the trimmed input, or to remove simple solvent molecules.</p></li><li><p><code>export_attributions</code> for the classes of the atoms, as defined by the clustering algorithm. This is exported as a PDB file, which can also be natively read by VMD: to see the attributions, switch to &quot;Type&quot; for the coloring method instead of &quot;Element&quot;.</p></li><li><p><code>export_clusters</code> for the clusters. The only difference with <code>export_subnets</code> is that the graph induced by the clusters is not trimmed yet.</p></li><li><p><code>export_net</code> for the net before separation into connected components. This is equivalent to catenating the result of <code>export_subnets</code> into a single file.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../../faq/">FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 19 October 2022 15:20">Wednesday 19 October 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
